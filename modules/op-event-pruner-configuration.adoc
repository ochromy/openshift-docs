// This module is included in the following assemblies:
// * install_config/customizing-configurations-in-the-tektonconfig-cr.adoc

:_mod-docs-content-type: PROCEDURE
[id="event-pruner-configuration_{context}"]
= Enabling the event-based pruner

:FeatureName: The event-based pruner
include::snippets/technology-preview.adoc[]

You can use the event-based `tektonpruner` controller to automatically delete completed resources, such as `PipelineRuns` and `TaskRuns`, based on configurable policies. Unlike the default job-based pruner, the event-based pruner listens for resource events and prunes resources in near real time.

You can use the event-based pruner alongside:

* Resource annotations
* {tekton-results}
* {PAC}

[NOTE]
====
The Operator does not currently restrict the use of these features with the event-based pruner. However, future releases might introduce validation if conflicts are observed.
====

[IMPORTANT]
====
You must disable the default pruner in the `TektonConfig` custom resource (CR) before you enable the event-based pruner. If both pruners are enabled, the deployment readiness status changes to `False` and output reads the following error message:

[source,terminal]
----
Components not in ready state: Invalid Pruner Configuration!! Both pruners, tektonpruner(event based) and pruner(job based) cannot be enabled simultaneously. Please disable one of them.
----
====

.Procedure

. In your TektonConfig CR, disable the default pruner by setting the `spec.pruner.disabled` field to `true` and enable the event-based pruner by setting the `spec.tektonpruner.disabled` field to `false`.  
+
.TektonConfig CR with the event-based pruner enabled
[source,yaml]
----
apiVersion: operator.tekton.dev/v1alpha1
kind: TektonConfig
metadata:
 name: config
spec:
  # ...
  pruner:
    disabled: true
  # ...
  tektonpruner:
    disabled: false
    options: {}
  # ...
----
+
After you apply the updated CR, the Operator deploys the `tekton-pruner-controller` pod in the `openshift-pipelines` namespace.

. Verify that the following ConfigMaps are present in the `openshift-pipelines` namespace:
+
[cols="1,3",options="header"]
|===
|ConfigMap 
|Purpose

|`tekton-pruner-default-spec`
|Define default pruning behavior

|`pruner-info`
|Store internal runtime data used by the controller

|`config-logging-tekton-pruner`
|Configure logging settings for the pruner

|`config-observability-tekton-pruner`
|Enable observability features such as metrics and tracing
|===

[IMPORTANT]
====
Unlike the default pruner, by modifying the `TektonConfig` CR you can enable or disable the event-based pruner only.
You can configure all other pruning behavior by modifying the `tekton-pruner-default-spec` ConfigMap.
====

.Verification

. To verify that the `tekton-pruner-controller` pod is running, run the following command:
+
[source,terminal]
----
$ oc get pods -n openshift-pipelines
----

. Verify that the output includes a `tekton-pruner-controller` pod in the `Running` state. Example output:
+
[source,terminal]
----
$ tekton-pruner-controller-<id>    Running
----
